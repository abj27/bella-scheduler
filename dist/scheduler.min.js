/**
 * bella-scheduler
 * v1.0.1
 * built: Mon, 18 Jul 2016 07:20:39 GMT
 * git: https://github.com/ndaidong/bella-scheduler
 * author: @ndaidong
 * License: MIT
**/
;(function(l,h){if("undefined"!==typeof module&&module.exports)module.exports=h();else{var q=window||{};q.define&&q.define.amd?q.define([],h):q.exports?q.exports=h():q[l]=h()}})("scheduler",function(){var l=new Map,h,q=function(c,f){for(var a=-1,b=0;b<c.length;b++)if(c[b]===f){a=b;break}return a},v=function(c,f){var a=c.match(/^(\d+)\s?(d|h|m|s)+$/i);if(a){var b=a,a=0,e=(new Date).getTime()-f;if(b){var n=parseInt(b[1],10),b=b[2];"s"===b?a=1E3:"m"===b?a=6E4:"h"===b?a=36E5:"d"===b&&(a=864E5);a=a*n-e}else a=
-1;return a}if(a=c.match(/^(sun|mon|tue|wed|thu|fri|sat)+\w*\s+(\d+)(:\d+)?(:\d+)?$/i)){var d=a,n="sun mon tue wed thu fri sat".split(" "),a=new Date,e=a.getDay(),e=q(n[e],n),b=d[1].toLowerCase(),l=q(b,n),h=b=n=0;d[2]&&(n=parseInt(d[2],10));d[3]&&(b=parseInt(d[3].replace(/\D/gi,""),10));d[4]&&(h=parseInt(d[4].replace(/\D/gi,""),10));a.setHours(n);a.setMinutes(b);a.setSeconds(h);var k=a.getTime(),d=(new Date).getTime(),r=a;if(l<e||d>k)a=new Date(a),a.setDate(a.getDate()+e+7-a.getDay()%7),r=a;r.setHours(n);
r.setMinutes(b);r.setSeconds(h);return r.getTime()-d}if(a=c.match(/^(\*|\d+)\s+(\*|\d+)\s+(\*|\d+)\s+(\*|\d+)\s+(\*|\d+)\s+(\d+)$/i)){var d=a,a="*"===d[1]?"*":parseInt(d[1],10),e="*"===d[2]?"*":parseInt(d[2],10),n="*"===d[3]?"*":parseInt(d[3],10),b="*"===d[4]?"*":parseInt(d[4],10),h="*"===d[5]?"*":parseInt(d[5],10),p="*"===d[6]?"*":parseInt(d[6],10),m=new Date,g=m.getFullYear();if("*"!==a&&a<g)a=-1;else{var d=a,l=e,k=n,r=b,t=h;"*"===a&&(d=g);g=m.getMonth()+1;"*"===e&&(l=g);g=m.getDate();"*"===n&&
(k=g);g=m.getHours();"*"===b&&(r=g);m=m.getMinutes();"*"===h&&(t=m);p=new Date(d,l-1,k,r,t,p);g=p.getTime();m=(new Date).getTime();g-=m;0>g&&"*"===h&&(p.setMinutes(t+1),g=p.getTime(),g-=m);0>g&&"*"===b&&(p.setHours(r+1),g=p.getTime(),g-=m);0>g&&"*"===n&&(p.setDate(k+1),g=p.getTime(),g-=m);0>g&&"*"===e&&(p.setMonth(l),g=p.getTime(),g-=m);0>g&&"*"===a&&(p.setFullYear(d+1),g=p.getTime(),g-=m);a=g}return a}return-1},w=function(c){c.fn();var f=c.id;if(!c.repeat)return l["delete"](f);var a=(new Date).getTime();
c.lastTick=a;l.set(f,c);return!0},u=function(){if(0<l.size){var c=2147483647,f=[];l.forEach(function(a){var b=a.id,e=v(a.time,a.lastTick);0>e?l["delete"](b):0===e?(a.delay=0,f.push(a)):(a.delay=e,l.set(b,a),e<=c&&(c=e,b=[],b=f.concat(a),f=b.filter(function(a){return a.delay<=c})))});h&&clearTimeout(h);f.length&&(h=setTimeout(function(){f.map(w);setTimeout(u,1)},c))}},k=function(c,f,a){a=a?0:1;var b=(new Date).getTime(),e;for(e=[];10>e.length;)e.push(Math.random().toString(36).slice(2));e=e.join("");
for(var h=e.length,d=Math.max(32,0),k="";k.length<d;)k+=e.charAt(Math.floor(Math.random()*h))||"";e=k;l.set(e,{id:e,fn:f,time:c,repeat:a,createdAt:b,lastTick:b,delay:0});u()};return{yearly:function(c,f){k("* "+c,f)},monthly:function(c,f){k("* * "+c,f)},daily:function(c,f){k("* * * "+c,f)},hourly:function(c,f){return k("* * * * "+c,f)},every:function(c,f){return k(c,f)},once:function(c,f){return k(c,f,1)}}});